<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="/css/profile.css">
    
</head>
<body>
    <header>

        <div class="container">
    
            <div class="profile">
    
                <div class="profile-image">
                    <img id="profilePicture" src="" alt="" style="height: 20rem;">
                </div>
    
                <div class="profile-user-settings" style="position: relative; left: 35px;">
                    <h1 class="profile-user-name" id="profileUserName">John</h1>
                    <div class="dropdown">
                        <a class="btn profile-edit-btn" href="/bio-edit" style="text-decoration: none;">Edit Profile <i class="fas fa-caret-down"></i></a>
                    </div>
                    <button class="btn profile-settings-btn" aria-label="profile settings"><i class="fas fa-cog" aria-hidden="true"></i></button>
                    <!-- Add Post Button -->
                    <a class="btn add-post-btn" aria-label="add post" href='/add-post' 
                    style="background-color: rgb(47, 212, 47); color: white; border: none; padding: 14px; text-decoration: none; cursor: pointer; 
                    font-size: 16px; font-weight: bold; border-radius: 5px; ">
                    Add Post <i class="fas fa-plus"></i>
                  </a>
                  <div class="paste-button">
                    <button class="button">Delete &nbsp; â–¼</button>
                    <div class="dropdown-content">
                      <a id="top" href="/delete-profilepic">Delete Profile Picture</a>
                      <a id="middle" href="/delete-bio">Delete Bio</a>
                      <a id="bottom" href="/delete-account">Delete Account</a>
                    </div>
                  </div>
               </div>


                <div class="profile-stats">
    
                    <ul>
                        <li><span class="profile-stat-count">164</span> posts</li>
                        <li><span class="profile-stat-count">188</span> followers</li>
                        <li><span class="profile-stat-count">206</span> following</li>
                    </ul>
    
                </div>
    
                <div class="profile-bio">
                    <p><span class="profile-real-name" style="position: relative; left: 35px;" id="bioText">ADD BIO ...</span></p>
                </div>
    
            </div>
            <!-- End of profile section -->
    
        </div>
        <!-- End of container -->
    
    </header>
    
    <main>
    
        <div class="container">
    
            <div class="gallery">
    
                <div class="gallery-item" tabindex="0">
    
                    <img src="https://images.unsplash.com/photo-1511765224389-37f0e77cf0eb?w=500&h=500&fit=crop" class="gallery-image" alt="">
    
                    <div class="gallery-item-info">
    
                        <ul>
                            <li class="gallery-item-likes"><span class="visually-hidden">Likes:</span><i class="fas fa-heart" aria-hidden="true"></i> 56</li>
                            <li class="gallery-item-comments"><span class="visually-hidden">Comments:</span><i class="fas fa-comment" aria-hidden="true"></i> 2</li>
                        </ul>
    
                    </div>
    
                </div>
    
                <div class="gallery-item" tabindex="0">
    
                    <img src="https://images.unsplash.com/photo-1497445462247-4330a224fdb1?w=500&h=500&fit=crop" class="gallery-image" alt="">
    
                    <div class="gallery-item-info">
    
                        <ul>
                            <li class="gallery-item-likes"><span class="visually-hidden">Likes:</span><i class="fas fa-heart" aria-hidden="true"></i> 89</li>
                            <li class="gallery-item-comments"><span class="visually-hidden">Comments:</span><i class="fas fa-comment" aria-hidden="true"></i> 5</li>
                        </ul>
    
                    </div>
    
                </div>
    
                <div class="gallery-item" tabindex="0">
    
                    <img src="https://images.unsplash.com/photo-1426604966848-d7adac402bff?w=500&h=500&fit=crop" class="gallery-image" alt="">
    
                    <div class="gallery-item-type">
    
                        <span class="visually-hidden">Gallery</span><i class="fas fa-clone" aria-hidden="true"></i>
    
                    </div>
    
                    <div class="gallery-item-info">
    
                        <ul>
                            <li class="gallery-item-likes"><span class="visually-hidden">Likes:</span><i class="fas fa-heart" aria-hidden="true"></i> 42</li>
                            <li class="gallery-item-comments"><span class="visually-hidden">Comments:</span><i class="fas fa-comment" aria-hidden="true"></i> 1</li>
                        </ul>
    
                    </div>
    
                </div>
    
              
    
                
    
            </div>
            <!-- End of gallery -->
    
           
        <!-- End of container -->
    
    </main>
    <script>
        async function fetchUserName() {
            try {
                // Extract parameters from the URL
                const urlParams = new URLSearchParams(window.location.search);
                const password = urlParams.get('password');
    
                // Make a fetch request to the /api/getUserName endpoint with password and name
                const response = await fetch(`/api/getUserName?password=${password}&name=${name}`);
    
                if (response.status === 401) {
                    // Redirect to the login page if not authenticated
                    window.location.href = '/login.html';
                    return;
                }
    
                const data = await response.json();
    
                // Update the content with the fetched username
                const profileUserName = document.getElementById('profileUserName');
    
                // Assuming the result is an array with a single object
                const userName = data.length > 0 ? data[0].name : 'User not found';
                profileUserName.innerText = userName;
    
            } catch (error) {
                console.error('Error fetching user name:', error);
            }
        }
    
        // Call the fetchUserName function when the page loads
        document.addEventListener('DOMContentLoaded', fetchUserName);

        //DROPDOWN Button
        function toggleDropdown() {
        var dropdownContent = document.getElementById("dropdownContent");
        dropdownContent.classList.toggle("show");
    }

    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
        if (!event.target.matches('.profile-edit-btn')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            for (var i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }
    </script>

<script>
    // Fetch bio data and populate the form fields
    fetch('/showBio')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            // Update the profile picture
            const profilePicture = document.getElementById('profilePicture');
            console.log(data.profilePic)
            if (data.profilePic) {
                
                profilePicture.src = `/images/${data.profilePic}`;
            } else {
                // Set a default image or leave it blank
                profilePicture.src = 'https://t4.ftcdn.net/jpg/00/64/67/27/360_F_64672736_U5kpdGs9keUll8CRQ3p3YaEv2M6qkVY5.jpg';
            }

            // Update the bio text
            const bioText = document.getElementById('bioText');
            bioText.textContent = data.description || 'ADD BIO ...';
        })
        .catch(error => console.error('Error fetching bio data:', error));
</script>
</body>
</html>