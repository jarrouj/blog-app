<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="/css/profile.css">
    <style>
   .popup {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  z-index: 1000;
}

.popup-content {
  padding: 20px;
}

/* Close Button Styles */
.close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 24px;
  cursor: pointer;
  color: #555;
}

.close-btn:hover {
  color: #333;
}

/* Form Styles */
form {
  text-align: center;
}

label {
  display: block;
  margin-bottom: 10px;
}

input[type="file"] {
  margin-bottom: 15px;
}

textarea {
  width: 100%;
  height: 80px;
  margin-bottom: 15px;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-sizing: border-box;
}

button {
  background-color: #4CAF50;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button:hover {
  background-color: #45a049;
}

/* Overlay Styles (to darken the background when the popup is open) */
.overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 900;
}

/* Additional Styles for Better Appearance */
body {
  margin: 0;
  font-family: 'Arial', sans-serif;
}

/* Show overlay when popup is open */
.popup.show, .overlay.show {
  display: block;
}

.gallery-item-likes a,
.gallery-item-comments a,
.gallery-item-edit a,
.gallery-item-delete a {
    text-decoration: none;
    color: #fff;
    font-weight: bold;
    margin-left: 5px; /* Add margin for spacing */
}

.gallery-item-likes a:hover,
.gallery-item-comments a:hover,
.gallery-item-edit a:hover,
.gallery-item-delete a:hover {
    text-decoration: underline;
    /* Add any additional styling for hover state */
}

    </style>
</head>
<body>
    <header>

        <div class="container">
    
            <div class="profile">
    
                <div class="profile-image">
                    <img id="profilePicture" src="https://t4.ftcdn.net/jpg/00/64/67/27/360_F_64672736_U5kpdGs9keUll8CRQ3p3YaEv2M6qkVY5.jpg" alt="" style="height: 20rem;">
                </div>
    
                <div class="profile-user-settings" style="position: relative; left: 35px;">
                    <h1 class="profile-user-name" id="profileUserName">John</h1>
                    <div class="dropdown">
                        <a class="btn profile-edit-btn" href="/bio-edit" style="text-decoration: none;">Edit Profile <i class="fas fa-caret-down"></i></a>
                    </div>
                    <button class="btn profile-settings-btn" aria-label="profile settings"><i class="fas fa-cog" aria-hidden="true"></i></button>
                    <!-- Add Post Button -->
                    <button class="btn add-post-btn" aria-label="add post" id="addPostBtn" 
                    style="background-color: rgb(47, 212, 47); color: white; border: none; padding: 14px; text-decoration: none; cursor: pointer; 
                    font-size: 16px; font-weight: bold; border-radius: 5px; ">
                    Add Post <i class="fas fa-plus"></i>
                </button>

                <div id="addPostPopup" class="popup">
                    <div class="popup-content">
                      <span class="close-btn" id="closePopupBtn">&times;</span>
                      <form id="addPostForm" action="/add-post" method="post" enctype="multipart/form-data">
                        <label for="postImage" style="font-size: 20px;">Select an image:</label>
                        <input type="file" name="postImage" accept="image/*" required>
                        <br>
                        <br>
                        <button type="submit">Upload Post</button>
                      </form>
                    </div>
                  </div>

                  <div class="paste-button">
                    <button class="button">Delete &nbsp; â–¼</button>
                    <div class="dropdown-content">
                      <a id="top" href="/delete-profilepic">Delete Profile Picture</a>
                      <a id="middle" href="/delete-bio">Delete Bio</a>
                      <a id="bottom" href="/delete-account">Delete Account</a>
                    </div>
                  </div>
               </div>


                <div class="profile-stats">
    
                    <ul>
                        <li><span class="profile-stat-count">164</span> posts</li>
                        <li><span class="profile-stat-count">188</span> followers</li>
                        <li><span class="profile-stat-count">206</span> following</li>
                    </ul>
    
                </div>
    
                <div class="profile-bio">
                    <p><span class="profile-real-name" style="position: relative; left: 35px;" id="bioText">ADD BIO ...</span></p>
                </div>
    
            </div>
    
        </div>    
    </header>
    
    <main>
    
        <div class="container">
    
          <div class="gallery" id="imageGallery"></div>
    
             
    
                
    
            </div>
            <!-- End of gallery -->
    
           
        <!-- End of container -->
    
    </main>

    <script>
      document.addEventListener('DOMContentLoaded', async () => {
  try {
    const response = await fetch('/show-images');
    const { images } = await response.json();

    const imageGallery = document.getElementById('imageGallery');

    images.forEach(image => {
  const galleryItem = document.createElement('div');
  galleryItem.classList.add('gallery-item');
  galleryItem.tabIndex = 0;

  const imgElement = document.createElement('img');
  imgElement.src = `/images/${image.image}`; // Assuming the image object has an 'image' property with the file name
  imgElement.classList.add('gallery-image');
  imgElement.alt = ''; // Set your alt text if needed

  const galleryItemInfo = document.createElement('div');
  galleryItemInfo.classList.add('gallery-item-info');

  const ulElement = document.createElement('ul');

  const likesListItem = document.createElement('li');
  likesListItem.classList.add('gallery-item-likes');
  likesListItem.innerHTML = `<span class="visually-hidden">Likes:</span><i class="fas fa-heart" aria-hidden="true"></i><a href="/edit-post"> Edit </a>`;

  const commentsListItem = document.createElement('li');
  commentsListItem.classList.add('gallery-item-comments');
  commentsListItem.innerHTML = `<span class="visually-hidden">Comments:</span><i class="fas fa-comment" aria-hidden="true"></i> <a href="/delete-post/${image.id}"> Delete </a>`;

  ulElement.appendChild(likesListItem);
  ulElement.appendChild(commentsListItem);

  galleryItemInfo.appendChild(ulElement);

  galleryItem.appendChild(imgElement);
  galleryItem.appendChild(galleryItemInfo);

  imageGallery.appendChild(galleryItem);
});
  } catch (error) {
    console.error('Error fetching and displaying images:', error);
  }
});
    </script>
    
    <script>
        async function fetchUserName() {
            try {
                // Extract parameters from the URL
                const urlParams = new URLSearchParams(window.location.search);
                const password = urlParams.get('password');
    
                // Make a fetch request to the /api/getUserName endpoint with password and name
                const response = await fetch(`/api/getUserName?password=${password}&name=${name}`);
    
                if (response.status === 401) {
                    // Redirect to the login page if not authenticated
                    window.location.href = '/login.html';
                    return;
                }
    
                const data = await response.json();
    
                // Update the content with the fetched username
                const profileUserName = document.getElementById('profileUserName');
    
                // Assuming the result is an array with a single object
                const userName = data.length > 0 ? data[0].name : 'User not found';
                profileUserName.innerText = userName;
    
            } catch (error) {
                console.error('Error fetching user name:', error);
            }
        }
    
        // Call the fetchUserName function when the page loads
        document.addEventListener('DOMContentLoaded', fetchUserName);

        //DROPDOWN Button
        function toggleDropdown() {
        var dropdownContent = document.getElementById("dropdownContent");
        dropdownContent.classList.toggle("show");
    }

    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
        if (!event.target.matches('.profile-edit-btn')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            for (var i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }
    </script>

<script>
    // Fetch bio data and populate the form fields
    fetch('/showBio')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            // Update the profile picture
            const profilePicture = document.getElementById('profilePicture');
            console.log(data.profilePic)
            profilePicture.onerror = function() {
                // Set a default image if the profile picture fails to load
                profilePicture.src = 'https://t4.ftcdn.net/jpg/00/64/67/27/360_F_64672736_U5kpdGs9keUll8CRQ3p3YaEv2M6qkVY5.jpg';
            };
            if (data.profilePic) {
                profilePicture.src = `/images/${data.profilePic}`;
            } else {
                // Set a default image or leave it blank
                profilePicture.src = 'https://t4.ftcdn.net/jpg/00/64/67/27/360_F_64672736_U5kpdGs9keUll8CRQ3p3YaEv2M6qkVY5.jpg';
            }

            // Update the bio text
            const bioText = document.getElementById('bioText');
            bioText.textContent = data.description || 'ADD BIO ...';
        })
        .catch(error => console.error('Error fetching bio data:', error));
</script>
<script>
    // JavaScript to handle the popup
    const addPostBtn = document.getElementById('addPostBtn');
    const addPostPopup = document.getElementById('addPostPopup');
    const closePopupBtn = document.getElementById('closePopupBtn');
  
    addPostBtn.addEventListener('click', () => {
      addPostPopup.style.display = 'block';
    });
  
    // Close the popup when the user clicks on the close button
    closePopupBtn.addEventListener('click', () => {
      addPostPopup.style.display = 'none';
    });
  
    // Close the popup when the user clicks outside of it
    window.addEventListener('click', (event) => {
      if (event.target === addPostPopup) {
        addPostPopup.style.display = 'none';
      }
    });
  </script>

</body>
</html>